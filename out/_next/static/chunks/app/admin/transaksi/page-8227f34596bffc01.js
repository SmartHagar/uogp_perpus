(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[339],{5057:function(a,e,t){Promise.resolve().then(t.bind(t,5738))},5738:function(a,e,t){"use strict";t.r(e),t.d(e,{default:function(){return page}});var s=t(7437),r=t(2265),l=t(5991),n=t(3423),i=t(7310),o=t(4660),d=t(4810),u=t(8875),c=t(5967);let g=(0,o.Ue)((0,d.mW)((a,e)=>({dtTransaksi:[],showTransaksi:[],setTransaksi:async e=>{let{page:t=1,limit:s=10,search:r,tahun:l,semester:n}=e;try{let e=await c.Z.getState().setToken(),i=await (0,u.Sj)({method:"get",url:"/transaksi",headers:{Authorization:"Bearer ".concat(e)},params:{limit:s,page:t,search:r,tahun:l,semester:n}});return a(a=>({...a,dtTransaksi:i.data.data})),{status:"berhasil",data:i.data}}catch(a){var i;return{status:"error",error:null===(i=a.response)||void 0===i?void 0:i.data}}},setShowTransaksi:async e=>{try{let t=await c.Z.getState().setToken(),s=await (0,u.Sj)({method:"get",url:"/transaksi/".concat(e),headers:{Authorization:"Bearer ".concat(t)}});return a(a=>({...a,showTransaksi:s.data.data})),{status:"berhasil",data:s.data}}catch(a){var t;return{status:"error",error:null===(t=a.response)||void 0===t?void 0:t.data}}},addData:async e=>{try{let t=await c.Z.getState().setToken(),s=await (0,u.Sj)({method:"post",url:"/transaksi",headers:{Authorization:"Bearer ".concat(t)},data:e});return a(a=>({dtTransaksi:{last_page:a.dtTransaksi.last_page,current_page:a.dtTransaksi.current_page,data:[s.data.data,...a.dtTransaksi.data]}})),{status:"berhasil tambah",data:s.data}}catch(a){return{status:"error",data:a.response.data}}},removeData:async e=>{try{let t=await c.Z.getState().setToken(),s=await (0,u.Sj)({method:"delete",url:"/transaksi/".concat(e),headers:{Authorization:"Bearer ".concat(t)}});return a(a=>({dtTransaksi:{last_page:a.dtTransaksi.last_page,current_page:a.dtTransaksi.current_page,data:a.dtTransaksi.data.filter(a=>a.id!==e)}})),{status:"berhasil hapus",data:s.data}}catch(a){return{status:"error",data:a.response.data}}},updateData:async(e,t)=>{try{let s=await c.Z.getState().setToken(),r=await (0,u.Sj)({method:"PUT",url:"/transaksi/".concat(e),headers:{Authorization:"Bearer ".concat(s)},data:t});return a(a=>({dtTransaksi:{last_page:a.dtTransaksi.last_page,current_page:a.dtTransaksi.current_page,data:a.dtTransaksi.data.map(a=>a.id===e?{...a,...r.data.data}:a)}})),{status:"berhasil update",data:r.data}}catch(a){return{status:"error",data:a.response.data}}}})));var h=t(4033),transaksi_ShowData=a=>{let{setDelete:e,setEdit:t,search:o}=a,{setTransaksi:d,dtTransaksi:u}=g(),[c,m]=(0,r.useState)(1),[p,x]=(0,r.useState)(10),[j,k]=(0,r.useState)(!0),b=(0,h.useSearchParams)(),f=b&&b.get("status")||"",fetchDataTransaksi=async()=>{await d({page:c,limit:p,search:o}),k(!1)};(0,r.useEffect)(()=>(fetchDataTransaksi(),()=>{}),[c,p]),(0,r.useEffect)(()=>{m(1),fetchDataTransaksi()},[o]);let v=["No","Anggota","Judul","Tgl. Pinjam","Aksi"],w=["anggota.nama","katalog.judul","tgl_pinjam"];if("pengembalian"===f){let a=v.length-1;v.splice(a,0,"Tgl. Kembali"),w.splice(a,0,"tgl_kembali")}return(0,s.jsx)("div",{className:"flex-1 flex-col max-w-full h-full overflow-auto",children:j?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)(l.Z,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"",children:(0,s.jsx)(i.Z,{headTable:v,tableBodies:w,dataTable:u.data,page:c,limit:p,setEdit:t,setDelete:e,ubah:!0,hapus:!0})}),(null==u?void 0:u.last_page)>1&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(n.Z,{currentPage:null==u?void 0:u.current_page,totalPages:null==u?void 0:u.last_page,setPage:m})})]})})},m=t(5782),p=t(8963),x=t(311),j=t(1865),k=t(2218),b=t.n(k),f=t(2067),v=t.n(f),input_InputDate=a=>{let{control:e,required:t,name:r,errors:l,addClass:n,label:i,startDate:o,setStartDate:d}=a;return(0,s.jsxs)("div",{className:n,children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700 tracking-wide block",children:[i,t&&(0,s.jsx)("span",{className:"ml-1 text-red-600",children:"*"})]}),(0,s.jsx)(j.Qr,{name:r,control:e,rules:{required:t},render:a=>{let{field:e}=a;return(0,s.jsx)(b(),{selected:o,onChange:a=>{if(a){d(a);let t=v()(a).format("YYYY-MM-DD");e.onChange(t)}else d(null),e.onChange("")},dateFormat:"dd/MM/yyyy",value:o||"",peekNextMonth:!0,showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"select",className:"w-full border rounded-lg py-2 px-4 bg-white"})}}),(null==l?void 0:l.type)==="required"&&(0,s.jsxs)("p",{className:"text-red-500 font-inter italic text-sm",children:[i," tidak boleh kosong"]})]})};let SelectDefault=a=>{var e;let{label:t,register:r,required:l,name:n,placeholder:i,defaultOption:o,options:d=[],errors:u,addClass:c}=a;return(0,s.jsxs)("div",{className:c,children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 tracking-wide",children:t}),l&&(0,s.jsx)("span",{className:"ml-1 text-red-600",children:"*"}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("select",{className:"w-full rounded-lg py-2 px-2 bg-white border border-gray-300 focus:outline-none focus:border-secondary",id:t,placeholder:i,...r(n,{required:l}),children:[(0,s.jsx)("option",{value:"",children:o}),d.map((a,e)=>(0,s.jsx)("option",{value:a.value,children:a.label},e))]})}),(null===(e=u[n])||void 0===e?void 0:e.type)==="required"&&(0,s.jsxs)("p",{className:"text-red-500 font-inter italic text-sm",children:[t," tidak boleh kosong"]})]})};var w=t(945);let _=(0,o.Ue)((0,d.mW)((a,e)=>({dtAnggota:[],setAnggota:async e=>{let{page:t=1,limit:s=10,search:r}=e;try{let e=await (0,u.hi)({method:"get",url:"/anggota",params:{limit:s,page:t,search:r}});return a(a=>({...a,dtAnggota:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}},setAnggotaAll:async e=>{let{search:t}=e;try{let e=await (0,u.hi)({method:"get",url:"/anggota/all",params:{search:t}});return a(a=>({...a,dtAnggota:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}}}))),y=(0,o.Ue)((0,d.mW)((a,e)=>({dtKatalog:[],setKatalog:async e=>{let{page:t=1,limit:s=10,search:r}=e;try{let e=await (0,u.hi)({method:"get",url:"/katalog",params:{limit:s,page:t,search:r}});return a(a=>({...a,dtKatalog:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}},setKatalogAll:async e=>{let{search:t}=e;try{let e=await (0,u.hi)({method:"get",url:"/katalog/all",params:{search:t}});return a(a=>({...a,dtKatalog:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}},setKatalogReady:async e=>{let{search:t,jenis:s}=e;try{let e=await (0,u.hi)({method:"get",url:"/katalog/ready",params:{search:t,jenis:s}});return a(a=>({...a,dtKatalog:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}}})));t(1240);var form_BodyForm=a=>{let{register:e,errors:t,control:l,dtEdit:n,watch:i,setValue:o,showModal:d,tgl_pinjam:u,setTgl_pinjam:c,setTgl_kembali:g,tgl_kembali:m}=a,{setAnggotaAll:p,dtAnggota:x}=_(),{setKatalogReady:j,dtKatalog:k}=y(),[b,f]=(0,r.useState)(),v=(0,h.useSearchParams)(),S=v&&v.get("status")||"",fetchDataAnggota=async a=>{let{search:e}=a;await p({search:e})};(0,r.useEffect)(()=>{fetchDataAnggota({})},[d]);let D=i("jenis")||"",fetchDataKatalog=async a=>{let{search:e,jenis:t}=a;await j({search:e,jenis:t}),f(!0)};return(0,r.useEffect)(()=>{f(!1),D&&(console.log({watchJenis:D}),fetchDataKatalog({jenis:D}))},[D]),(0,s.jsxs)(s.Fragment,{children:[(null==x?void 0:x.data)&&(0,s.jsx)(w.Z,{label:"Anggota",placeholder:"Pilih Anggota",name:"anggota_id",dataDb:null==x?void 0:x.data,body:["id","NPM","nama"],control:l,required:!0,errors:t.anggota_id,addClass:"col-span-4"}),(0,s.jsx)(SelectDefault,{label:"Jenis Katalog",defaultOption:"Pilih Jenis",register:e,errors:t,name:"jenis",options:[{value:"buku",label:"Buku"},{value:"jurnal",label:"Jurnal"},{value:"tugas akhir",label:"Tugas Akhir"}],addClass:"col-span-4 lg:col-span-1",required:!0}),b&&(null==k?void 0:k.data)&&(0,s.jsx)(w.Z,{label:"Katalog",placeholder:"Pilih Katalog",name:"katalog_id",dataDb:null==k?void 0:k.data,body:["id","judul","penulis","tahun"],control:l,required:!0,errors:t.katalog_id,addClass:"col-span-4 lg:col-span-3 "}),(0,s.jsx)(input_InputDate,{label:"Tgl. Peminjaman",name:"tgl_pinjam",control:l,startDate:u,setStartDate:c,required:!0,errors:t.tgl_pinjam,addClass:"col-span-4 lg:col-span-2"}),"pengembalian"===S&&(0,s.jsx)(input_InputDate,{label:"Tgl. Kembali",name:"tgl_kembali",control:l,startDate:m,setStartDate:g,required:!0,errors:t.tgl_kembali,addClass:"col-span-4 lg:col-span-2"})]})},S=t(8528),form_Form=a=>{let{showModal:e,setShowModal:t,dtEdit:l}=a,{addData:n,updateData:i}=g(),[o,d]=(0,r.useState)(new Date),[u,c]=(0,r.useState)(""),k=(0,h.useSearchParams)(),b=k&&k.get("status")||"",{register:f,handleSubmit:v,setValue:w,control:_,formState:{errors:y},watch:D}=(0,j.cI)(),resetForm=()=>{w("id",""),w("anggota_id",""),w("katalog_id",""),w("tgl_pinjam",new Date),w("tgl_kembali",""),d(new Date),c(""),w("jenis",""),w("denda",0)};(0,r.useEffect)(()=>{l?(w("id",l.id),w("anggota_id",l.anggota_id),w("katalog_id",l.katalog_id),w("jenis",l.katalog.jenis),w("tgl_pinjam",l.tgl_pinjam),w("tgl_kembali",l.tgl_kembali),d(new Date(l.tgl_pinjam)),c(l.tgl_kembali?new Date(l.tgl_kembali):"")):resetForm()},[e,l]);let onSubmit=async a=>{if(a.status=b,console.log({row:a}),l){let{data:e}=await i(l.id,a);(0,x.Z)({event:e}),t(!1)}else{let{data:e}=await n(a);console.log({data:e}),(0,x.Z)({event:e}),(null==e?void 0:e.type)!=="success"||resetForm()}};return(0,s.jsx)(p.Z,{title:"Form Transaksi",showModal:e,setShowModal:t,children:(0,s.jsxs)("form",{onSubmit:v(onSubmit),children:[(0,s.jsx)(m.Z,{name:"id",register:f,type:"hidden"}),(0,s.jsx)("div",{className:"grid grid-cols-4 gap-2 mb-4",children:(0,s.jsx)(form_BodyForm,{register:f,errors:y,dtEdit:l,control:_,watch:D,setValue:w,showModal:e,tgl_pinjam:o,setTgl_pinjam:d,tgl_kembali:u,setTgl_kembali:c})}),(0,s.jsx)("div",{children:(0,s.jsx)(S.Z,{onClick:v(onSubmit),children:"Simpan"})})]})})},D=t(3015),T=t(5925),N=t(8001),page=()=>{let{removeData:a}=g(),[e,t]=(0,r.useState)(!1),[l,n]=(0,r.useState)(!1),[i,o]=(0,r.useState)(),[d,u]=(0,r.useState)(),[c,m]=(0,r.useState)(""),p=(0,h.useSearchParams)(),j=p&&p.get("status"),setDelete=async e=>{let{id:t,isDelete:s}=e;if(o(t),s){let{data:e}=await a(i);(0,x.Z)({event:e}),n(!1)}else n(!0)};return(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(T.x7,{}),(0,s.jsx)(form_Form,{dtEdit:d,showModal:e,setShowModal:t}),(0,s.jsx)(D.Z,{showDel:l,setShowDel:n,setDelete:setDelete}),(0,s.jsxs)("div",{className:"mb-4 flex justify-between",children:[(0,s.jsxs)("p",{children:["Silahkan mengolah data transaksi ",j]}),"pengembalian"!==j&&(0,s.jsx)("div",{children:(0,s.jsx)(S.Z,{onClick:()=>{t(!0),u(null)},children:"Tambah"})})]}),(0,s.jsx)(N.Z,{placeholder:"Cari Transaksi",onChange:a=>m(a)})]}),(0,s.jsx)(transaksi_ShowData,{setDelete:setDelete,setEdit:a=>{t(!0),u(a)},search:c})]})}},945:function(a,e,t){"use strict";var s=t(7437);t(2265);var r=t(8749),l=t(1865);e.Z=a=>{let{dataDb:e,body:t,control:n,required:i,name:o,errors:d,placeholder:u,addClass:c,label:g,defaultOptions:h=!0}=a,m={multiValue:(a,e)=>e.data.isFixed?{...a,backgroundColor:"gray"}:a,multiValueLabel:(a,e)=>e.data.isFixed?{...a,fontWeight:"bold",color:"white",paddingRight:6}:a,multiValueRemove:(a,e)=>e.data.isFixed?{...a,display:"none"}:a},getProperty=(a,e)=>{let t=a[e];if("id"===e)return{value:t,label:""};if(!e.includes("."))return{value:"",label:t};{let[t,...s]=e.split("."),r=a[t];return getProperty(r,s.join("."))}},myOptions=()=>{let a=e&&e.map((a,e)=>{let s=t.map(e=>getProperty(a,e)),r=s.map(a=>a.label).filter(a=>""!==a),l=r.join(r.length>1?" - ":"");return{value:s.find(a=>""!==a.value).value,label:l}});return a},filterData=a=>{var e;return null===(e=myOptions())||void 0===e?void 0:e.filter(e=>e.label.toLowerCase().includes(a.toLowerCase()))},loadOptions=(a,e)=>{setTimeout(()=>{e(filterData(a))},1e3)};return(0,s.jsxs)("div",{className:c,children:[g&&(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 tracking-wide",children:g}),i&&(0,s.jsx)("span",{className:"ml-1 text-red-600",children:"*"}),(0,s.jsx)(l.Qr,{name:o,control:n,rules:{required:i},render:a=>{var e;let{field:{onChange:t,value:l,ref:n}}=a;return(0,s.jsx)(r.Z,{cacheOptions:!0,defaultOptions:h,isClearable:!0,isSearchable:!0,loadOptions:loadOptions,placeholder:u,menuPlacement:"auto",menuPosition:"fixed",styles:m,ref:n,value:(null===(e=myOptions())||void 0===e?void 0:e.find(a=>a.value===l))||null,onChange:a=>t(a?a.value:a)})}}),(null==d?void 0:d.type)==="required"&&(0,s.jsxs)("p",{className:"text-red-500 font-inter italic text-sm",children:[g," tidak boleh kosong"]})]})}}},function(a){a.O(0,[447,990,463,103,665,589,971,472,744],function(){return a(a.s=5057)}),_N_E=a.O()}]);