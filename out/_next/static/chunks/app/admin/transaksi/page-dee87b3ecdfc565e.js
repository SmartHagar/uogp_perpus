(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[339],{5057:function(a,e,t){Promise.resolve().then(t.bind(t,7232))},7232:function(a,e,t){"use strict";t.r(e),t.d(e,{default:function(){return page}});var s=t(7437),l=t(2265),r=t(5991),n=t(3423),i=t(7310),d=t(4660),o=t(4810),u=t(8875),c=t(5967);let g=(0,d.Ue)((0,o.mW)((a,e)=>({dtTransaksi:[],showTransaksi:[],setTransaksi:async e=>{let{page:t=1,limit:s=10,search:l,tahun:r,semester:n}=e;try{let e=await c.Z.getState().setToken(),i=await (0,u.Sj)({method:"get",url:"/transaksi",headers:{Authorization:"Bearer ".concat(e)},params:{limit:s,page:t,search:l,tahun:r,semester:n}});return a(a=>({...a,dtTransaksi:i.data.data})),{status:"berhasil",data:i.data}}catch(a){var i;return{status:"error",error:null===(i=a.response)||void 0===i?void 0:i.data}}},setShowTransaksi:async e=>{try{let t=await c.Z.getState().setToken(),s=await (0,u.Sj)({method:"get",url:"/transaksi/".concat(e),headers:{Authorization:"Bearer ".concat(t)}});return a(a=>({...a,showTransaksi:s.data.data})),{status:"berhasil",data:s.data}}catch(a){var t;return{status:"error",error:null===(t=a.response)||void 0===t?void 0:t.data}}},addData:async e=>{try{let t=await c.Z.getState().setToken(),s=await (0,u.Sj)({method:"post",url:"/transaksi",headers:{Authorization:"Bearer ".concat(t)},data:e});return a(a=>({dtTransaksi:{last_page:a.dtTransaksi.last_page,current_page:a.dtTransaksi.current_page,data:[s.data.data,...a.dtTransaksi.data]}})),{status:"berhasil tambah",data:s.data}}catch(a){return{status:"error",data:a.response.data}}},removeData:async e=>{try{let t=await c.Z.getState().setToken(),s=await (0,u.Sj)({method:"delete",url:"/transaksi/".concat(e),headers:{Authorization:"Bearer ".concat(t)}});return a(a=>({dtTransaksi:{last_page:a.dtTransaksi.last_page,current_page:a.dtTransaksi.current_page,data:a.dtTransaksi.data.filter(a=>a.id!==e)}})),{status:"berhasil hapus",data:s.data}}catch(a){return{status:"error",data:a.response.data}}},updateData:async(e,t)=>{try{let s=await c.Z.getState().setToken(),l=await (0,u.Sj)({method:"PUT",url:"/transaksi/".concat(e),headers:{Authorization:"Bearer ".concat(s)},data:t});return a(a=>({dtTransaksi:{last_page:a.dtTransaksi.last_page,current_page:a.dtTransaksi.current_page,data:a.dtTransaksi.data.map(a=>a.id===e?{...a,...l.data.data}:a)}})),{status:"berhasil update",data:l.data}}catch(a){return{status:"error",data:a.response.data}}}})));var m=t(4033),transaksi_ShowData=a=>{let{setDelete:e,setEdit:t,search:d}=a,{setTransaksi:o,dtTransaksi:u}=g(),[c,h]=(0,l.useState)(1),[p,x]=(0,l.useState)(10),[j,f]=(0,l.useState)(!0),k=(0,m.useSearchParams)(),b=k&&k.get("status")||"",fetchDataTransaksi=async()=>{await o({page:c,limit:p,search:d}),f(!1)};(0,l.useEffect)(()=>(fetchDataTransaksi(),()=>{}),[c,p]),(0,l.useEffect)(()=>{h(1),fetchDataTransaksi()},[d,b]);let v=["No","Anggota","Judul","Tgl. Pinjam","Aksi"],y=["anggota.nama","katalog.judul","tgl_pinjam"];if("pengembalian"===b){let a=v.length-1;v.splice(a,0,"Tgl. Kembali"),y.splice(a,0,"tgl_kembali");let e=v.length-1;v.splice(e,0,"Denda"),y.splice(e,0,"denda")}return(0,s.jsx)("div",{className:"flex-1 flex-col max-w-full h-full overflow-auto",children:j?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)(r.Z,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"",children:(0,s.jsx)(i.Z,{headTable:v,tableBodies:y,dataTable:u.data,page:c,limit:p,setEdit:t,setDelete:e,ubah:!0,hapus:!0})}),(null==u?void 0:u.last_page)>1&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(n.Z,{currentPage:null==u?void 0:u.current_page,totalPages:null==u?void 0:u.last_page,setPage:h})})]})})},h=t(5782),p=t(8963),x=t(311),j=t(1865),f=t(2218),k=t.n(f),b=t(2067),v=t.n(b),input_InputDate=a=>{let{control:e,required:t,name:l,errors:r,addClass:n,label:i,startDate:d,setStartDate:o}=a;return(0,s.jsxs)("div",{className:n,children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700 tracking-wide block",children:[i,t&&(0,s.jsx)("span",{className:"ml-1 text-red-600",children:"*"})]}),(0,s.jsx)(j.Qr,{name:l,control:e,rules:{required:t},render:a=>{let{field:e}=a;return(0,s.jsx)(k(),{selected:d,onChange:a=>{if(a){o(a);let t=v()(a).format("YYYY-MM-DD");e.onChange(t)}else o(null),e.onChange("")},dateFormat:"dd/MM/yyyy",value:d||"",peekNextMonth:!0,showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"select",className:"w-full border rounded-lg py-2 px-4 bg-white"})}}),(null==r?void 0:r.type)==="required"&&(0,s.jsxs)("p",{className:"text-red-500 font-inter italic text-sm",children:[i," tidak boleh kosong"]})]})},input_InputDateMinMax=a=>{let{control:e,required:t,name:l,errors:r,addClass:n,label:i,startDate:d,setStartDate:o,minDate:u,maxDate:c}=a;return(0,s.jsxs)("div",{className:n,children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700 tracking-wide block",children:[i,t&&(0,s.jsx)("span",{className:"ml-1 text-red-600",children:"*"})]}),(0,s.jsx)(j.Qr,{name:l,control:e,rules:{required:t},render:a=>{let{field:e}=a;return(0,s.jsx)(k(),{selected:d,onChange:a=>{if(a){o(a);let t=v()(a).format("YYYY-MM-DD");e.onChange(t)}else o(null),e.onChange("")},dateFormat:"dd/MM/yyyy",value:d||"",peekNextMonth:!0,showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"select",className:"w-full border rounded-lg py-2 px-4 bg-white",placeholderText:"dd/mm/yyyy",minDate:u,maxDate:c})}}),(null==r?void 0:r.type)==="required"&&(0,s.jsxs)("p",{className:"text-red-500 font-inter italic text-sm",children:[i," tidak boleh kosong"]})]})};let SelectDefault=a=>{var e;let{label:t,register:l,required:r,name:n,placeholder:i,defaultOption:d,options:o=[],errors:u,addClass:c}=a;return(0,s.jsxs)("div",{className:c,children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 tracking-wide",children:t}),r&&(0,s.jsx)("span",{className:"ml-1 text-red-600",children:"*"}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("select",{className:"w-full rounded-lg py-2 px-2 bg-white border border-gray-300 focus:outline-none focus:border-secondary",id:t,placeholder:i,...l(n,{required:r}),children:[(0,s.jsx)("option",{value:"",children:d}),o.map((a,e)=>(0,s.jsx)("option",{value:a.value,children:a.label},e))]})}),(null===(e=u[n])||void 0===e?void 0:e.type)==="required"&&(0,s.jsxs)("p",{className:"text-red-500 font-inter italic text-sm",children:[t," tidak boleh kosong"]})]})};var y=t(945);let w=(0,d.Ue)((0,o.mW)((a,e)=>({dtAnggota:[],setAnggota:async e=>{let{page:t=1,limit:s=10,search:l}=e;try{let e=await (0,u.hi)({method:"get",url:"/anggota",params:{limit:s,page:t,search:l}});return a(a=>({...a,dtAnggota:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}},setAnggotaAll:async e=>{let{search:t}=e;try{let e=await (0,u.hi)({method:"get",url:"/anggota/all",params:{search:t}});return a(a=>({...a,dtAnggota:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}}})));var _=t(6446);t(1240);var form_BodyForm=a=>{var e;let{register:t,errors:r,control:n,dtEdit:i,watch:d,setValue:o,showModal:u,tgl_pinjam:c,setTgl_pinjam:g,setTgl_kembali:p,tgl_kembali:x}=a,{setAnggotaAll:j,dtAnggota:f}=w(),{setKatalogReady:k,dtKatalog:b}=(0,_.Z)(),[D,S]=(0,l.useState)(),T=(0,m.useSearchParams)(),N=T&&T.get("status")||"",fetchDataAnggota=async a=>{let{search:e}=a;await j({search:e})};(0,l.useEffect)(()=>{fetchDataAnggota({})},[u]);let M=d("jenis")||"",fetchDataKatalog=async a=>{let{search:e,jenis:t}=a;await k({search:e,jenis:t}),S(!0)};(0,l.useEffect)(()=>{S(!1),M&&fetchDataKatalog({jenis:M})},[M]);let Z=d("tgl_pinjam"),C=d("tgl_kembali"),countDays=()=>{if(Z&&C){let a=v()(C).diff(v()(Z),"days");a>4?o("denda",5e3*(a-4)):o("denda",0)}};return(0,l.useEffect)(()=>{countDays()},[Z,C]),(0,s.jsxs)(s.Fragment,{children:[(null==f?void 0:f.data)&&(0,s.jsx)(y.Z,{label:"Anggota",placeholder:"Pilih Anggota",name:"anggota_id",dataDb:null==f?void 0:f.data,body:["id","NPM","nama"],control:n,required:!0,errors:r.anggota_id,addClass:"col-span-4"}),i?(0,s.jsx)("div",{className:"col-span-4",children:null==i?void 0:null===(e=i.katalog)||void 0===e?void 0:e.judul}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(SelectDefault,{label:"Jenis Katalog",defaultOption:"Pilih Jenis",register:t,errors:r,name:"jenis",options:[{value:"buku",label:"Buku"},{value:"jurnal",label:"Jurnal"},{value:"tugas akhir",label:"Tugas Akhir"}],addClass:"col-span-4 lg:col-span-1",required:!0}),D&&(null==b?void 0:b.data)&&(0,s.jsx)(y.Z,{label:"Katalog",placeholder:"Pilih Katalog",name:"katalog_id",dataDb:null==b?void 0:b.data,body:["id","judul","penulis","tahun"],control:n,required:!0,errors:r.katalog_id,addClass:"col-span-4 lg:col-span-3 "})]}),(0,s.jsx)(input_InputDate,{label:"Tgl. Peminjaman",name:"tgl_pinjam",control:n,startDate:c,setStartDate:g,required:!0,errors:r.tgl_pinjam,addClass:"col-span-4 lg:col-span-2"}),"pengembalian"===N&&i.tgl_pinjam&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(input_InputDateMinMax,{label:"Tgl. Kembali",name:"tgl_kembali",control:n,startDate:x,setStartDate:p,required:!0,errors:r.tgl_kembali,addClass:"col-span-4 lg:col-span-2",minDate:new Date(null==i?void 0:i.tgl_pinjam)}),(0,s.jsx)(h.Z,{label:"Denda (Rp.)",name:"denda",register:t,maxLength:12,required:!0,errors:r.denda,addClass:"col-span-4",readOnly:!0})]})]})},D=t(8528),form_Form=a=>{let{showModal:e,setShowModal:t,dtEdit:r}=a,{addData:n,updateData:i}=g(),[d,o]=(0,l.useState)(new Date),[u,c]=(0,l.useState)(""),f=(0,m.useSearchParams)(),k=f&&f.get("status")||"",{register:b,handleSubmit:y,setValue:w,control:_,formState:{errors:S},watch:T}=(0,j.cI)(),resetForm=()=>{w("id",""),w("anggota_id",""),w("katalog_id",""),w("tgl_pinjam",v()(new Date).format("YYYY-MM-DD")),w("tgl_kembali",""),o(new Date),c(""),w("jenis",""),w("denda",0)};(0,l.useEffect)(()=>{r?(w("id",r.id),w("anggota_id",r.anggota_id),w("katalog_id",r.katalog_id),w("jenis",r.katalog.jenis),w("tgl_pinjam",r.tgl_pinjam),w("tgl_kembali",r.tgl_kembali),o(new Date(r.tgl_pinjam)),c(r.tgl_kembali?new Date(r.tgl_kembali):"")):resetForm()},[e,r]);let onSubmit=async a=>{if(a.status=k,delete a.jenis,console.log({row:a}),r){let{data:e}=await i(r.id,a);(0,x.Z)({event:e}),t(!1)}else{let{data:e}=await n(a);console.log({data:e}),(0,x.Z)({event:e}),(null==e?void 0:e.type)!=="success"||resetForm()}};return(0,s.jsx)(p.Z,{title:"Form Transaksi",showModal:e,setShowModal:t,children:(0,s.jsxs)("form",{onSubmit:y(onSubmit),children:[(0,s.jsx)(h.Z,{name:"id",register:b,type:"hidden"}),(0,s.jsx)("div",{className:"grid grid-cols-4 gap-2 mb-4",children:(0,s.jsx)(form_BodyForm,{register:b,errors:S,dtEdit:r,control:_,watch:T,setValue:w,showModal:e,tgl_pinjam:d,setTgl_pinjam:o,tgl_kembali:u,setTgl_kembali:c})}),(0,s.jsx)("div",{children:(0,s.jsx)(D.Z,{onClick:y(onSubmit),children:"Simpan"})})]})})},S=t(3015),T=t(5925),N=t(8001),page=()=>{let{removeData:a}=g(),[e,t]=(0,l.useState)(!1),[r,n]=(0,l.useState)(!1),[i,d]=(0,l.useState)(),[o,u]=(0,l.useState)(),[c,h]=(0,l.useState)(""),p=(0,m.useSearchParams)(),j=p&&p.get("status"),setDelete=async e=>{let{id:t,isDelete:s}=e;if(d(t),s){let{data:e}=await a(i);(0,x.Z)({event:e}),n(!1)}else n(!0)};return(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(T.x7,{}),(0,s.jsx)(form_Form,{dtEdit:o,showModal:e,setShowModal:t}),(0,s.jsx)(S.Z,{showDel:r,setShowDel:n,setDelete:setDelete}),(0,s.jsxs)("div",{className:"mb-4 flex justify-between",children:[(0,s.jsxs)("p",{children:["Silahkan mengolah data transaksi ",j]}),"pengembalian"!==j&&(0,s.jsx)("div",{children:(0,s.jsx)(D.Z,{onClick:()=>{t(!0),u(null)},children:"Tambah"})})]}),(0,s.jsx)(N.Z,{placeholder:"Cari Transaksi",onChange:a=>h(a)})]}),(0,s.jsx)(transaksi_ShowData,{setDelete:setDelete,setEdit:a=>{t(!0),u(a)},search:c})]})}},945:function(a,e,t){"use strict";var s=t(7437);t(2265);var l=t(8749),r=t(1865);e.Z=a=>{let{dataDb:e,body:t,control:n,required:i,name:d,errors:o,placeholder:u,addClass:c,label:g,defaultOptions:m=!0}=a,h={multiValue:(a,e)=>e.data.isFixed?{...a,backgroundColor:"gray"}:a,multiValueLabel:(a,e)=>e.data.isFixed?{...a,fontWeight:"bold",color:"white",paddingRight:6}:a,multiValueRemove:(a,e)=>e.data.isFixed?{...a,display:"none"}:a},getProperty=(a,e)=>{let t=a[e];if("id"===e)return{value:t,label:""};if(!e.includes("."))return{value:"",label:t};{let[t,...s]=e.split("."),l=a[t];return getProperty(l,s.join("."))}},myOptions=()=>{let a=e&&e.map((a,e)=>{let s=t.map(e=>getProperty(a,e)),l=s.map(a=>a.label).filter(a=>""!==a),r=l.join(l.length>1?" - ":"");return{value:s.find(a=>""!==a.value).value,label:r}});return a},filterData=a=>{var e;return null===(e=myOptions())||void 0===e?void 0:e.filter(e=>e.label.toLowerCase().includes(a.toLowerCase()))},loadOptions=(a,e)=>{setTimeout(()=>{e(filterData(a))},1e3)};return(0,s.jsxs)("div",{className:c,children:[g&&(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 tracking-wide",children:g}),i&&(0,s.jsx)("span",{className:"ml-1 text-red-600",children:"*"}),(0,s.jsx)(r.Qr,{name:d,control:n,rules:{required:i},render:a=>{var e;let{field:{onChange:t,value:r,ref:n}}=a;return(0,s.jsx)(l.Z,{cacheOptions:!0,defaultOptions:m,isClearable:!0,isSearchable:!0,loadOptions:loadOptions,placeholder:u,menuPlacement:"auto",menuPosition:"fixed",styles:h,ref:n,value:(null===(e=myOptions())||void 0===e?void 0:e.find(a=>a.value===r))||null,onChange:a=>t(a?a.value:a)})}}),(null==o?void 0:o.type)==="required"&&(0,s.jsxs)("p",{className:"text-red-500 font-inter italic text-sm",children:[g," tidak boleh kosong"]})]})}},6446:function(a,e,t){"use strict";var s=t(4660),l=t(4810),r=t(8875);let n=(0,s.Ue)((0,l.mW)((a,e)=>({dtKatalog:[],setKatalog:async e=>{let{page:t=1,limit:s=10,orderBy:l,sort:n,search:i}=e;try{let e=await (0,r.hi)({method:"get",url:"/katalog",params:{limit:s,page:t,orderBy:l,sort:n,search:i}});return a(a=>({...a,dtKatalog:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}},setKatalogAll:async e=>{let{search:t}=e;try{let e=await (0,r.hi)({method:"get",url:"/katalog/all",params:{search:t}});return a(a=>({...a,dtKatalog:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}},setKatalogReady:async e=>{let{search:t,jenis:s}=e;try{let e=await (0,r.hi)({method:"get",url:"/katalog/ready",params:{search:t,jenis:s}});return a(a=>({...a,dtKatalog:e.data})),{status:"berhasil",data:e.data}}catch(a){return{status:"error",error:a.response.data}}},setKatalogDetail:async e=>{try{let t=await (0,r.hi)({method:"get",url:"/katalog/detail/".concat(e)});return a(a=>{var e;return{...a,dtKatalog:null===(e=t.data)||void 0===e?void 0:e.data}}),{status:"berhasil",data:t.data}}catch(a){return{status:"error",error:a.response.data}}}})));e.Z=n}},function(a){a.O(0,[447,990,580,758,166,677,342,701,589,971,472,744],function(){return a(a.s=5057)}),_N_E=a.O()}]);